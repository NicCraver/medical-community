(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-122b5f69"],{"8d6c":function(e,t,a){"use strict";a("de2d")},"9b88":function(e,t,a){"use strict";a("b535")},a0c6:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"DiseaseTag"},[t("ProLayout",{attrs:{mainBgColor:"#F5F5F5",padding:"0"},scopedSlots:e._u([{key:"title",fn:function(){return[e._v("病种对照")]},proxy:!0},{key:"main",fn:function(){return[t("ProList",{staticClass:"ProList",attrs:{pageParams:e.pageParams,total:e.total,onInquire:e.onInquire},scopedSlots:e._u([{key:"header",fn:function(){return[t("el-select",{attrs:{placeholder:"编码分类",clearable:"",filterable:""},model:{value:e.queryParams.icdType,callback:function(t){e.$set(e.queryParams,"icdType",t)},expression:"queryParams.icdType"}},e._l(e.icdTypeList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1),t("el-input",{attrs:{placeholder:"编码/名称",clearable:""},model:{value:e.queryParams.icdId,callback:function(t){e.$set(e.queryParams,"icdId",t)},expression:"queryParams.icdId"}}),t("el-select",{attrs:{placeholder:"请选择标签状态",clearable:"",filterable:""},model:{value:e.queryParams.tagStatus,callback:function(t){e.$set(e.queryParams,"tagStatus",t)},expression:"queryParams.tagStatus"}},e._l(e.tagStatusList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1),t("el-date-picker",{attrs:{type:"daterange","value-format":"yyyy-MM-dd","start-placeholder":"创建开始日期","end-placeholder":"创建结束日期","range-separator":"至",clearable:""},model:{value:e.addDate,callback:function(t){e.addDate=t},expression:"addDate"}})]},proxy:!0},{key:"actions",fn:function(){return[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onInquire()}}},[e._v("搜索")]),t("el-button",{on:{click:e.resetQueryParams}},[e._v("重置")])]},proxy:!0},{key:"batchActions",fn:function(){return[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.showTagDetail("add")}}},[e._v("新增")]),t("el-button",{on:{click:e.batchStart}},[e._v("批量关闭")]),0!==e.multipleSelection.length?t("div",{staticClass:"alert"},[t("IconSvg",{staticStyle:{margin:"0 5px 0 5px"},attrs:{iconClass:"prompt",width:"18"}}),t("div",{staticStyle:{margin:"0 5px 0 5px"}},[e._v("已选择 "+e._s(e.multipleSelection.length)+"项")]),t("el-button",{staticStyle:{margin:"0 5px 0 5px"},attrs:{type:"text"},on:{click:e.clearFun}},[e._v(" 清空 ")])],1):e._e()]},proxy:!0}])},[t("el-table",{directives:[{name:"adaptive",rawName:"v-adaptive",value:{bottomOffset:60},expression:"{ bottomOffset: 60 }"},{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"singleTable",attrs:{data:e.tableData,height:"100px",border:""},on:{"selection-change":e.handleSelectionChange}},[t("el-table-column",{attrs:{type:"selection",width:"40",selectable:e=>0===e.status}}),t("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-table",{staticStyle:{width:"88%","margin-left":"88px"},attrs:{data:a.row.children,border:"","tooltip-effect":"dark"}},e._l(e.sonColumns,(function(e,a){return t("el-table-column",{key:a,attrs:{label:e.name,prop:e.propName,width:e.width,"show-overflow-tooltip":!0}})})),1)]}}])}),e._l(e.parentsCloums,(function(a){return t("el-table-column",{key:a.propName,attrs:{label:a.name,width:a.width},scopedSlots:e._u([{key:"default",fn:function(i){return["status"==a.propName?t("div",[t("el-switch",{attrs:{value:i.row[a.propName],"active-value":0,"inactive-value":1},nativeOn:{click:function(t){return e.handleSwitchChange(i.row)}}}),t("span",{class:["status",0===i.row[a.propName]?"active":"inactive"]},[e._v(e._s(0===i.row[a.propName]?"开启":"关闭"))])],1):t("div",[e._v(" "+e._s(i.row[a.propName])+" ")])]}}],null,!0)})})),t("el-table-column",{attrs:{label:"操作",fixed:"right",width:"150"},scopedSlots:e._u([{key:"default",fn:function({row:a}){return[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.showTagDetail("check",a)}}},[e._v("查看")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.showTagDetail("edit",a)}}},[e._v("编辑")]),0!==a.status?t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleDelete(a)}}},[e._v("删除")]):e._e()]}}])})],2)],1)]},proxy:!0}])}),t("ProDrawer",{staticClass:"tag-drawer",attrs:{visible:e.drawerVisible,title:"新增病种标签对照",direction:"rtl",size:600,"show-close":""},on:{"update:visible":function(t){e.drawerVisible=t}}},[t("ReferenceForm",{ref:"drawerTagDetail",attrs:{mode:e.tagDetailMode,tagDetail:e.tagDetail,icdTypeList:e.icdTypeList}}),t("template",{slot:"footer"},[t("el-button",{attrs:{type:"default"},on:{click:e.cancelChange}},[e._v("取消")]),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSubmitTagDetail("drawerTagDetail")}}},[e._v("确认")])],1)],2),t("ProDialog",{attrs:{visible:e.dialogVisible,title:"edit"===e.tagDetailMode?"编辑病种标签对照":"查看病种标签对照",width:"700px","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}},scopedSlots:e._u([{key:"footer",fn:function(){return["edit"===e.tagDetailMode?t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]):e._e(),"edit"===e.tagDetailMode?t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleSubmitTagDetail("dialogTagDetail")}}},[e._v(" 保存 ")]):e._e(),"check"===e.tagDetailMode?t("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("返回")]):e._e()]},proxy:!0}])},[t("ReferenceForm",{ref:"dialogTagDetail",attrs:{mode:e.tagDetailMode,tagDetail:e.tagDetail,icdTypeList:e.icdTypeList}})],1)],1)},s=[],l=(a("14d9"),a("a211")),n=function(){var e=this,t=e._self._c;return t("el-form",{ref:"elForm",staticClass:"tag-form",attrs:{disabled:"check"===e.mode,"label-width":"110px",model:e.tagDetail,rules:e.rules}},[t("el-form-item",{staticClass:"inlineDefault is-required",attrs:{label:"选择纳入病种"}},["add"===e.mode||"edit"===e.mode?t("span",{staticClass:"icon-add"},[t("i",{staticClass:"el-icon-plus",on:{click:e.addDiseaseChange}})]):e._e(),t("div",{class:{contentIcdHeight:e.tagDetail.icdIds.length>7}},e._l(e.tagDetail.icdIds,(function(a,i){return t("div",{key:i},["edit"==e.mode?t("el-switch",{staticClass:"switchTxt",attrs:{"active-value":0,"inactive-value":1,"active-text":"开启","inactive-text":"停用"},model:{value:a.status,callback:function(t){e.$set(a,"status",t)},expression:"item.status"}}):e._e(),t("el-select",{staticStyle:{width:"185px"},attrs:{placeholder:"请选择编码分类"},on:{change:function(t){return e.selectChanged(a)}},model:{value:a.diseasesType,callback:function(t){e.$set(a,"diseasesType",t)},expression:"item.diseasesType"}},e._l(e.codeClassification,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value,disabled:e.disabled}})})),1),t("el-select",{staticStyle:{width:"250px","margin-left":"12px"},attrs:{filterable:"",remote:"",placeholder:"请输入编码/名称检索下拉框","remote-method":t=>e.remoteSearchAdGroup(t,a),loading:e.loading},on:{"visible-change":t=>e.clearRecord(t,a)},model:{value:a.label,callback:function(t){e.$set(a,"label",t)},expression:"item.label"}},e._l(e.codeSearchList,(function(i){return t("el-option",{key:i.value,attrs:{label:i.label,value:i.label},nativeOn:{click:function(t){return e.getItemChange(i,a)}}})})),1),t("span",{staticClass:"icon-del"},["add"==e.mode?t("span",[e.tagDetail.icdIds.length>1?t("i",{staticClass:"el-icon-delete allow-del",on:{click:function(t){return e.delDiseaseChange(a)}}}):t("i",{staticClass:"el-icon-delete noAllow-del"})]):"edit"==e.mode?t("span",[e.tagDetail.icdIds.length>1&&1==a.status?t("i",{staticClass:"el-icon-delete allow-del",on:{click:function(t){return e.delDiseaseChange(a)}}}):e.tagDetail.icdIds.length>1&&0==a.status?t("i",{staticClass:"el-icon-delete noAllow-del",on:{click:function(t){return e.delDiseaseChange(a)}}}):t("i",{staticClass:"el-icon-delete noAllow-del"})]):e._e()])],1)})),0)]),t("el-form-item",{staticClass:"inlineDefault is-required",attrs:{label:"关联病种标签"}},[t("el-cascader",{attrs:{options:e.deptData,placeholder:"科室"},on:{change:e.handleChange},model:{value:e.tagDetail.deptId,callback:function(t){e.$set(e.tagDetail,"deptId",t)},expression:"tagDetail.deptId"}}),t("el-select",{staticStyle:{"margin-left":"12px"},attrs:{placeholder:"请选择"},on:{"visible-change":e.getGiftListTable,change:e.updateValueChange},model:{value:e.tagDetail.tagDiseaseDeptId,callback:function(t){e.$set(e.tagDetail,"tagDiseaseDeptId",t)},expression:"tagDetail.tagDiseaseDeptId"}},e._l(e.typeDiseaseList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{staticClass:"outlineDefault",attrs:{label:"总状态",prop:"status"}},[t("el-switch",{staticClass:"switchTxt",attrs:{"active-value":0,"inactive-value":1,"active-text":"开启","inactive-text":"关闭"},model:{value:e.tagDetail.status,callback:function(t){e.$set(e.tagDetail,"status",t)},expression:"tagDetail.status"}})],1)],1)},r=[],c=a("365c");const o=e=>c["a"].post({url:"/ygt-user/tbIcdDiseaseTag/onQueryIcdDiseaseTags",data:e}),d=e=>c["a"].post({url:"/ygt-user/tbIcdDiseaseTagMain/onChangeStatus",data:e}),u=e=>c["a"].post({url:"/ygt-user/tbIcdDiseaseTagMain/onDelIcdDiseaseTagMain",data:e}),h=e=>c["a"].get({url:"/ygt-user/tbDictionaryDetail/getIcdTypes",params:e}),p=e=>c["a"].get({url:"/ygt-user/tbIcdDictionary/getIcdDicForOrderBy",params:e}),g=e=>c["a"].get({url:"/ygt-user/tbTagDiseaseDept/getDeptDictionaryForIcd",params:e}),D=e=>c["a"].get({url:"/ygt-user/tbTagDiseaseDept/getTagDiseaseByDeptId",params:e}),m=e=>c["a"].post({url:"/ygt-user/tbIcdDiseaseTag/onSaveIcdDiseaseTag",data:e});var f={props:["mode","tagDetail","icdTypeList"],data(){return{rules:{},deptData:[],typeDiseaseList:[],codeClassification:[],loading:!1,codeSearchList:[],oldcutval:""}},mounted(){this.codeClassification=this.icdTypeList?this.icdTypeList:[],this.getDeptDictionaryForIcd()},methods:{updateValueChange(e){if("edit"==this.mode){let t=this.tagDetail.beforeDeptId[this.tagDetail.beforeDeptId.length-1],a=this.tagDetail.deptId[this.tagDetail.deptId.length-1];if(a==t){let t="";this.typeDiseaseList.forEach(a=>{a.value==e&&(t=a.label)}),e!==this.tagDetail.beforeTagDiseaseDeptId&&this.$confirm(`关联病种标签由${this.oldcutval}变更为${t}，是否确定变更？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{}).catch(()=>{this.tagDetail.tagDiseaseDeptId=this.tagDetail.beforeTagDiseaseDeptId})}}},selectChanged(e){e.id=""},clearRecord(e,t){e&&this.remoteSearchAdGroup(t.id,t)},remoteSearchAdGroup(e,t){if(e){if(!t.diseasesType)return this.$message.warning("请先选择编码分类");this.loading=!0,this.getIcdDicForOrderBy(e,t)}else this.codeSearchList=[]},async getIcdDicForOrderBy(e,t){try{const a=await p({value:e,type:t.diseasesType});0==a.code&&(this.loading=!1,this.codeSearchList=a.result)}catch(a){this.loading=!1}},getItemChange(e,t){t.id=e.value},getGiftListTable(e){if(e){if(!this.tagDetail.deptId.length)return this.$message.warning("请先选择科室");let e=this.tagDetail.deptId[this.tagDetail.deptId.length-1];this.getTagDiseaseByDeptId(e)}},async getTagDiseaseByDeptId(e){try{const t=await D({deptId:e});if(0==t.code){if(this.typeDiseaseList=t.result,"edit"==this.mode){let e=this.typeDiseaseList.filter(e=>e.value===this.tagDetail.beforeTagDiseaseDeptId);this.oldcutval=e.length?e[0].label:""}}else this.typeDiseaseList=[]}catch(t){}},addDiseaseChange(){if(this.tagDetail.icdIds.length>20||20==this.tagDetail.icdIds.length)return this.$message.warning("最多可添加20个对照的纳入病种");let e=new Object;e.seq=this.tagDetail.icdIds[this.tagDetail.icdIds.length-1].seq+1,e.status=0,e.diseasesType="",e.label="",e.id="",this.tagDetail.icdIds.push(e)},delDiseaseChange(e){if("add"==this.mode)this.stopDel(e);else{if(0==e.status)return this.$message.warning("请先选择停用，停用后可删除");this.stopDel(e)}},stopDel(e){this.tagDetail.icdIds=this.tagDetail.icdIds.filter(t=>t.seq!=e.seq),this.$message.success("删除成功")},handleChange(){this.tagDetail.tagDiseaseDeptId=""},async getDeptDictionaryForIcd(){try{const e=await g(),t=e.result;this.filterDeptData(t),this.deptData=t}catch(e){}},filterDeptData(e){e.forEach(e=>{e.children.length?this.filterDeptData(e.children):e.children=null})},validate(e){this.$refs.elForm.validate(t=>{t&&e()})}}},y=f,b=(a("8d6c"),a("efff"),a("2877")),v=Object(b["a"])(y,n,r,!1,null,"63bdae68",null),I=v.exports,w={components:{ProList:l["ProList"],ProLayout:l["ProLayout"],ProDrawer:l["ProDrawer"],ProDialog:l["ProDialog"],IconSvg:l["IconSvg"],ReferenceForm:I},data(){return{icdTypeList:[],tagStatusList:[{label:"开启",value:0},{label:"关闭",value:1}],addDate:[],multipleSelection:[],loading:!1,queryParams:{},pageParams:{pageNum:1,pageSize:10},total:0,drawerVisible:!1,tagDetailMode:"add",tagDetail:{},dialogVisible:!1,parentsCloums:[{name:"序号",propName:"seq",width:"50"},{name:"对照标签",propName:"tagShowDesc"},{name:"关联病种数",propName:"diseaseTot"},{name:"总状态",propName:"status"},{name:"创建人",propName:"createUserName"},{name:"创建时间",propName:"createDate"}],tableData:[],sonColumns:[{name:"序号",propName:"seq",width:"50"},{name:"目录类型",propName:"icdTypeDesc"},{name:"主要编码",propName:"icdCode"},{name:"诊断名称",propName:"icdName",width:"200"},{name:"纳入状态",propName:"statusDesc"},{name:"更新人",propName:"modUserName"},{name:"更新时间",propName:"modDate",width:"175"}]}},mounted(){this.getIcdTypes(),this.onInquire()},methods:{async getIcdTypes(){try{const e=await h();0==e.code?this.icdTypeList=e.result:this.icdTypeList=[]}catch(e){}},handleSelectionChange(e){this.multipleSelection=e},async onInquire(){try{const e=await o({...this.queryParams,createDateS:this.addDate&&this.addDate[0]?this.addDate[0]+" 00:00:00":"",createDateE:this.addDate&&this.addDate[1]?this.addDate[1]+" 23:59:59":"",...this.pageParams});this.tableData=e.result.records,this.tableData.forEach(e=>{for(let t in e)if("children"==t&&e["children"].length){let t=["icdTypeDesc","icdCode","icdName","statusDesc","modUserName","modDate"];e["children"].forEach(e=>{t.forEach(t=>{""===e[t]&&(e[t]="/")})})}else""===e[t]&&(e[t]="/")}),this.total=e.result.total}catch(e){}},handleDelete(e){this.$confirm("您确定要删除关联标签及标签下全部纳入病种吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.deleteAllTip(e)}).catch(()=>{})},async deleteAllTip(e){try{const t=await u({id:e.id});0==t.code&&(this.$message.success("删除成功"),this.onInquire())}catch(t){}},showTagDetail(e,t){if(this.tagDetailMode=e,"add"===e)this.tagDetail={icdIds:[{seq:1,diseasesType:"",label:"",id:"",status:0}],deptId:[],tagDiseaseDeptId:"",status:0},this.drawerVisible=!0;else{this.dialogVisible=!0;let e=[],a=t.children;a.forEach(t=>{let a=new Object;a.seq=t.seq,a.status=t.status,a.diseasesType=t.icdType,a.label=t.icdName,a.id=t.icdId,e.push(a)}),this.tagDetail={icdIds:e,id:t.id,deptId:t.deptIds,beforeDeptId:t.deptIds,tagDiseaseDeptId:t.tagDiseaseDeptId,beforeTagDiseaseDeptId:t.tagDiseaseDeptId,status:t.status};let i=this.tagDetail.deptId[this.tagDetail.deptId.length-1];this.$nextTick(()=>{this.$refs.dialogTagDetail.getTagDiseaseByDeptId(i)})}},batchStart(){if(this.multipleSelection.length){let e=[];this.multipleSelection.forEach(t=>{e.push(t.id)});const t={ids:e,status:1};this.changeStatus(t),this.clearFun()}else this.$message.warning("请先选择需要批量关闭的列表")},async changeStatus(e){try{await d(e);this.$message.success("状态更新完成"),this.onInquire()}catch(t){}},resetQueryParams(){this.queryParams={},this.pageParams={pageSize:10,pageNum:1},this.addDate=[],this.onInquire()},clearFun(){this.$refs.singleTable.clearSelection()},cancelChange(){let e=[];if(this.tagDetail.icdIds.forEach((t,a)=>{(t.diseasesType||t.id)&&e.push(a)}),(this.tagDetail.deptId.length||this.tagDetail.relationDeptId)&&e.push(Math.round(15*Math.random())),!e.length)return this.drawerVisible=!1,this.$message.success("取消成功");this.$confirm("您有未保存的记录，确认要离开吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.drawerVisible=!1}).catch(()=>{})},async handleSubmitTagDetail(e){let t=[];if(this.tagDetail.icdIds.forEach((e,a)=>{e.diseasesType&&e.id||t.push(a)}),(this.tagDetail.deptId&&!this.tagDetail.deptId.length||!this.tagDetail.tagDiseaseDeptId)&&t.push(10*Math.random()),t.length)return this.$message.warning("请校验当前页面信息是否配置完整");let a=this.tagDetail.icdIds,i=a.map(e=>e.id),s=Array.from(new Set(i));if(s.length!==i.length)return this.$message.warning("不能选择相同的疾病编码");try{let t="",a="",i={...this.tagDetail};"drawerTagDetail"===e?(a="新增对照成功",t="drawerVisible"):(t="dialogVisible",a="编辑保存成功");const s=await m(i);0===s.code?(this.$message.success(a),this[t]=!1,this.queryParams={},this.pageParams={pageSize:10,pageNum:1}):this.$message.error(s.data.desc),this.onInquire()}catch(l){}},async handleSwitchChange(e){try{let t=[e.id];const a={ids:t,status:0===e.status?1:0},i=await d(a);0==i.code&&(this.$message.success("状态更新完成"),this.onInquire())}catch(t){}}}},T=w,k=(a("9b88"),Object(b["a"])(T,i,s,!1,null,"779de33f",null));t["default"]=k.exports},b535:function(e,t,a){},d5ae:function(e,t,a){},de2d:function(e,t,a){},efff:function(e,t,a){"use strict";a("d5ae")}}]);